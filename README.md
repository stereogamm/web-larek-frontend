# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами 
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Описание интерфейсов данных и типов данных, используемых в приложении
```

интерфейс для данных товара
export interface IItem {
    category: string;
    title: string;
    image: string;
    price: number | null;
    description: string;
    id: string;
}
```
```

интерфейс для данных пользователя
export interface IUserData {
    adress: string;
    email: string;
    phone: string;
    payment: string;
    getUserData(): IUserData; //данные пользователя для заказа
    checkUserInfoValidation(data: Record<keyof IDataUserPopup, string>): boolean; //проверка корректности данных пользователя
}
```
```

интерфейс для данных заказа
export interface IOrder {
    email: string;
    phone: string;
    address: string;
    payment: string;
    items: IItem[];
    total: number | null;
}
```
```

интерфейс каталогa товаров
export interface IListItem {
    items: IItem[]; //массив карточек
    preview: string | null; //id открытой карточки
    addItemToBasket(item: string, payload: Function | null): void; //добавляем товар по id в корзину
    deleteItemFromBasket(item: string, payload: Function | null): void; //удаляем товар по id из корзины
    showOneItem(item: string): void; //открываем карточку для просмотра по id 
    getItems(): IItem[]; //получаем массив карточек с сервера
    saveItems(): IItem[]; //сохраняем массив карточек
}
```
```

интерфейс корзины товаров
export interface IBacket {
    items: IItem[];
    total: number | null;
    resetBasket(): void; //очищение данных после успешного заказа
}
```
```

интерфейс открытой для просмотра карточки товара 
export interface IExploreItem {
    items: IItem[];
    preview: string | null;
}
```
```

тип данных для модального окна с выбором способа оплаты
export type IPaymentPopup = Pick<IUserData, 'adress'>;
```
```

тип данных для модального окна с данными пользователя
export type IDataUserPopup = Pick<IUserData, 'adress' | 'phone'>;
```
```

тип данных для модального окна успешного завершения заказа
export type IOrderSuccessPopup = Pick<IOrder, 'total'>;
```
```

тип данных для отображения карточки товара в корзине
export type IPopupItemInBacket = Pick<IItem, 'title' | 'price'>
```

# Архитектура приложения

## Приложение реализует разделение на слои в парадигме MVP 

- *Слой данных* - отвечает за хранение и работу с данными - `Models`
- *Слой отображения* - отвечает за отображение данных на странице - `View`
- *Связующий слой* с доступом к моделям и вью - `Presenter` 

# Базовый код

### Базовый класс `Api`

 Реализует логику работы с сервером. Содержит конструктор для создания объекта со свойствами базового url адреса и хэдеров запроса.

- `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

 Также содержит `get` и `post` методы, которые отвечают за формирование и асинхронную отправку запроса и вызов защищенного метода `handleResponse`. Метод `handleResponse` асинхронно преобразовывает ответ сервера в формат json в случае успеха и возвращает его, в случае неуспеха - возвращает значение поля statusText  


### Базовый класс  `EventEmitter`

Класс представляет собой систему управления событиями, позволяющую добавлять, удалять и вызывать обработчики событий.\
Конструктор создает пустой объект `Map`, который будет хранить события и их подписчиков.\

- `constructor()={}`

Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
- Метод `on` - добавляет обработчик для конкретного события.
- Метод `off` - удаляет обработчик для конкретного события.
- Метод `emit` - вызывает все обработчики для указанного события, передавая им данные.
- Метод `onAll` - добавляет обработчик, который будет вызываться для всех событий.
- Метод `offAll` - удаляет все обработчики для всех событий.
- Метод `trigger` - создает функцию-триггер, которая при вызове инициирует событие с указанным именем и данными.

# Слой данных

### класс `DataHandler`

Отвечает за данные и логику работы с данными товаров\

Содержит поля:\
- productList: IItem[]  список объектов карточек для отображения на главной\ 
- basketList: IItem[]   список объектов товаров корзины\
- preview: IItem объект открытой карточки для превью\       
- total: number | null  общая стоимость всех товаров\
- order: IOrder = { объект заказа\ 
        email: '',\
        phone: '',\
        address: '',\
        payment: '',\
        items: [],\
        total: 0\
    };
- formErrors: IFormErrors = {} объект ошибок валидации формы

Методы класса для взаимодействия с данными: 

- setProductList(items: IItem[]) присваивает полученные с сервера данные в ProductList
- showOneItem(id: string) возвращает объект открытой карточки для просмотра по id
- addItemtoBasket(item: IItem) добавление товара в корзину
- removeItemFromBasket(id: string) удаление товара из корзины
- resetBasket() очищает корзину
- getTotalSum() рассчитывает общую сумму всех товаров 
- getCountBasketItems() возвращает количество товаров в корзине для дальнейшего отображения счетчика на главной
- validationOrderInfoIsChecked() проверка на заполненность полей данными о способе оплаты и адресе
- validationUserInfoIsChecked() проверка на заполенность полей данными о емейле и телефоне
- setOrder() добавление id продукта в поле заказа
- setPreview(id: string) сохраняет в поле id открытой карточки
- getPreview() получает id открытой карточки
- getBasketList() получает список товаров корзины
- setPaymentType (value: string) сохраняет выбранный тип оплаты


### класс `UserData`

Отвечает за данные пользователя и логику работы с ними\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 

- `_adress: string;` хранит данные адреса пользователя
- `_email: string;`  хранит данные почты пользователя
- `_phone: string;`  хранит данные номера телефона пользователя
- `_payment: string;` хранит данные выбранного способа оплаты пользователя
- `events: IEvents;` экземпляр класса EventEmitter для генерации событий при изменении данных (хранится в каждом классе)

Методы класса для взаимодействия с данными: 

- `getUserData(): IUserData;`  возвращает объект с данными пользователя
- `checkUserInfoValidation(): boolean;`
- функции `get(), set();` для доступа и работы со свойствами объекта-инстанса этого класса

### класс `BasketData`

Отвечает за работу с корзиной покупок\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 
- `_items: IItem[];`  список товаров в корзине
- `_total: number | null;` общая сумма товаров, добавленных в корзину
- `events: IEvents;` экземпляр класса EventEmitter для генерации событий при изменении данных (хранится в каждом классе)

Методы класса для взаимодействия с данными: 

- `resetBasket(): void;` очищение данных после успешного заказа
- функции `get(), set();`  для доступа и работы со свойствами объекта-инстанса этого класса
 

### класс `OrderData`

Отвечает за работу с данными заказа\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 

- `_email: string;` 
- `_phone: string;`
- `_address: string;`
- `_payment: string;`
- `_items: IItem[];`
- `_total: number | null;`

Методы класса для взаимодействия с данными: 

- `createOrder(data: IOrder, payload: Function | null): void` отправка заказа 
- функции `get(), set();`  для доступа и работы со свойствами объекта-инстанса этого класса

# Слой представления 

Отвечает за отображение внутри DOM-элемента передаваемых в него данных

### класс Component 

*Абстрактный!* класс `Component` служит шаблоном для создания компонентов, которые будут работать с элементами DOM. Он позволяет определять общую функциональность для всех компонентов, а также обязывает подклассы реализовать определенные в нем методы. Такой подход помогает в организации и повторном использовании кода.

- `constructor(container: HTMLElement);`

Mетоды:

- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` переключает класс (если есть-удаляет, если нет - добавляет)
- `setText(element: HTMLElement, value: unknown): void` добавляет указанный текст в разметку элемента
- `setDisabled(element: HTMLElement, state: boolean): void` переключает состояние элемента
- `setHidden(element: HTMLElement): void` скрывает элемент
- `setVisible(element: HTMLElement): void` делает элемент видимым
- `render(data?: Partial<T>): HTMLElement` возвращает корневой элемент


### класс `Card`

Отвечает за отображение карточек на главной странице, в модальном окне просмотра карточки, в корзине. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки карточки. \
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

- `constructor(card: HTMLElement, ivent: IEvents)`

Реализует методы:

- `setData(cardData: IItem): void;` заполняет данными элементы карточки
- `getCard(card: object): HTMLElement;` возвращает заполненную данными карточку
- `getIdCard(card: object): string`  возвращает id карточки
- `set() и get()` - для доступа к свойствам  

### класс `Main`

Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

- `constructor(conteiner: HTMLElement)`

### класс `ModalPopUp` 

*ОБЩИЙ* класс модального окна. Предоставляет методы `open` и `close`, а также слушатели закрытия модального окна при клике на клавишу esc, overlay, кнопку с срестиком.

Конструктор принимает селектор, по которому в разметке будет найдено необходимое модальное окно и экземпляр класса EventEmitter для инициации событий 

- `constructor(selector: string, events: IEvents);`

Содержит поля:

- `modal: HTMLElement;` 
- `events: IEvents;`

Реализует методы:

- `openPopupWindow(): void;`
- `closePopupWindow(): void;`
- `addContentToPopupWindow(template: HTMLElement): void;` заполнение модального окна контентом


### класс `BasketPopUp` 

Расширяет класс `ModalPopUp`. Отвечает за отображениие выбранных товаров в корзине

Содержит поля:

- `basketList: HTMLListElement;` список товаров 
- `submitButton: HTMLButtonSubmit;` кнопка подтверждения
- `totalSum: HTMLElement;` элемент для отображения общей стоимости товаров 

Реализует метод:

- `showCards(card: HTMLElement): void;` добавляет элемент карточки в список корзины


### класс `FormsPopUp`

Расширяет класс `ModalPopUp`. Отвечает за работу с полями ввода формы. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в поле ввода - инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. 

Содержит поля:

- `submitButton: HTMLButtonElement;` кнопка подтверждения
- `formName: string;` значение атрибута name формы
- `form: HTMLElement;` элемент формы
- `inputs: [];` список инпутов формы
- `errors: Record<string, HTMLElement>;`  объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name

Реализует методы:

- `setValid(isValid: bolean): void;` изменяет активность кнопки подтверждения 
- `getInputValues(): Record<string, string>;` возвращает объект с данными формы. Ключ - значение атрибута name элемента формы, value - пользовательское значение. 
- `setError(data: { field: string, value: string, validInformation: string }): void;` принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void;` отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void;` очищает текст ошибки под указанным полем ввода
- `close (): void;` расширяет родительский метод дополнительно при закрытии очищая поля формы 
- `get (form: HTMLElement);` геттер для получения элемента формы


### класс `SucessOrderPopup` 

Расширяет класс `ModalPopUp`. Отвечает за отображение модального окна после успешного завершения заказа. 

Содержит поля: 
- `submitButton: HTMLElement;` кнопка возврата к списку товаров
- `totalSum: HTMLElement;` элемент для отображения общей стоимости заказа

Реализует метод:
- `goBackToMainPage(): void;` закрывает модальное окно, очищает корзину


# Коммуникационный слой

Отвечает за взаимодействие с сервером\
Все взаимодействие строится на работе с событиями

получаем данные -> генерируем события -> выполняем действия\
данные в модели изменяются -> генерируем событие -> выполняем действия

### Класс `AppApi`

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

- `constructor()`

## Взаимодействие компонентов

Код, описывающий взаимодействие слоя представления и слоя данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

- `itemsData:changed` - изменение массива карточек
- `itemsData:selected` - изменение открываемой в модальном окне карточки
- `basketData:changed` - изменение данных в корзине товаров
- `userData:changed` - изменение данных пользователя при заполнении формы
- `itemsData:previewClear` - очистка модального окна просмотра выбранной карточки от данных 
- `order:ready` - формирование данных для заказа

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `card:open` - открытие карточки для просмотра
- `card:added` - клик по кнопке добавления товара в корзину
- `modal:close` - клик на иконку закрытия модального окна/клик на кнопку в модальном окне успешного заказа для перехода на главную
- `modal:open` - открытие модального окна 
- `card:delete` - клик на иконку удаление товара из корзины
- `edit-adress:input` - редактирование данных в поле адреса
- `edit-payment:changed`- редактирование способа оплаты
- `edit-email:input` - редактирование даннх в поле почты
- `edit-phone:input` - редактирование данных в поле телефона
- `form-payment:submit` - клик на кнопку далее в модальном окне со способом оплаты
- `form-userdata:submit` - клик на кнопку далее в модальном окне с данными пользователя
- `form-payment:validation` - событие необходимости валидации всей формы с данными способа оплаты (влияет на активность кнопки)
- `form-userdata:validation` - событие необходимости валидации всей формы с данными юзера (влияет на активность кнопки)
- `basket:validation`- событие необходимости валидировать, что в корзине есть товары
- `basketIs:opened` - клик по иконке корзины на главной 